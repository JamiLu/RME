"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var App=function(){var App=function(){function App(){_classCallCheck(this,App);this.self;this.seq=0;this.prefix="app";this.name;this.root}_createClass(App,null,[{key:"name",value:function name(_name){App.init().name=App.checkName(_name);return App}},{key:"root",value:function root(_root){if(!Util.isEmpty(_root)&&Util.isString(_root))App.init().root=_root;return App}},{key:"checkName",value:function checkName(name){if(!Util.isEmpty(name)){return App.init().prefix+name}else{while(Util.isEmpty(App.init().name)){name=App.init().prefix+App.init().seq;name=AppManager.get(name);if(Util.isEmpty(name)){App.init().name=App.init().prefix+App.init().seq;break}else{App.init().seq++}}return App.init().name}}},{key:"reset",value:function reset(){App.init().name=undefined;App.init().root=undefined;App.init().seq=0}},{key:"create",value:function create(object){var name=Util.notEmpty(App.init().name)?App.init().name:App.checkName();var root=Util.notEmpty(App.init().root)?App.init().root:undefined;var app=new AppInstance(name,root,object);AppManager.set(name,app);App.reset();return app}},{key:"get",value:function get(name){if(Util.isEmpty(name))return App.name(0).getInstance();else{var app=App.name(name).getInstance();if(Util.isEmpty(app))throw"Could not find app with name: "+name;else return app}}},{key:"setState",value:function setState(refName,value,update){return App.get().setState(refName,value,update)}},{key:"getState",value:function getState(refName){return App.get().getState(refName)}},{key:"isStateEmpty",value:function isStateEmpty(refName){return App.get().isStateEmpty(refName)}},{key:"clearState",value:function clearState(refName,update){return App.get().clearState(refName,update)}},{key:"mergeState",value:function mergeState(key,value,update){return App.get().mergeState(key,value,update)}},{key:"getInstance",value:function getInstance(){if(Util.isEmpty(App.init().name))throw"No App instance selected, invoke a function name() first";var app=AppManager.get(App.init().name);App.reset();return app}},{key:"component",value:function component(_component){var bindState=function bindState(appName){var updater=Util.isEmpty(appName)?function(){return function(state){return App.getState(state)}}:function(){return function(state){return App.get(appName).getState(state)}};RMEComponentManager.addComponent(_component,updater)};return bindState}},{key:"init",value:function init(){if(Util.isEmpty(this.self))this.self=new App;return this.self}}]);return App}();var AppInstance=function(){function AppInstance(name,root,object){_classCallCheck(this,AppInstance);this.rawStage=object;this.name=name;this.root;this.state={};this.renderer;this.oldStage="";this.router;this.ready=false;this.setState=this.setState.bind(this);this.getState=this.getState.bind(this);this.refresh=this.refreshApp.bind(this);this.afterRefreshCallQueue=[];this.refreshQueue;this.bindReadyListener(root)}_createClass(AppInstance,[{key:"bindReadyListener",value:function bindReadyListener(root){var _this=this;if(document.readyState==="loading"||document.readyState==="interactive"){document.addEventListener("readystatechange",function(){if(document.readyState==="complete")_this.init(root)})}else{this.init(root)}}},{key:"init",value:function init(root){this.root=Util.isEmpty(root)?Tree.getBody():Tree.getFirst(root);this.renderer=new RMEElemRenderer(this.root);this.ready=true;this.refreshApp()}},{key:"refreshApp",value:function refreshApp(){var _this2=this;if(this.ready){if(this.refreshQueue)Util.clearTimeout(this.refreshQueue);this.refreshQueue=Util.setTimeout(function(){var freshStage=Template.isTemplate(_this2.rawStage)?Template.resolve(_this2.rawStage):_this2.rawStage.duplicate();if(!Util.isEmpty(_this2.router)){var state=_this2.router.getCurrentState();if(!Util.isEmpty(state.current)){var selector=state.root;var element=state.current;if(Template.isFragment(element)){var fragment={};fragment[state.rootElem.toLiteralString()]=_objectSpread({},element.fragment);freshStage.getFirst(selector).replace(Template.resolve(fragment))}else{freshStage.getFirst(selector).append(element)}if(!Util.isEmpty(state.onAfter))_this2.afterRefreshCallQueue.push(state.onAfter)}}if(_this2.oldStage.toString()!==freshStage.toString()){_this2.oldStage=_this2.renderer.merge(_this2.oldStage,freshStage)}_this2.refreshAppDone();Util.clearTimeout(_this2.refreshQueue)})}}},{key:"refreshAppDone",value:function refreshAppDone(){this.afterRefreshCallQueue.forEach(function(callback){return callback()});this.afterRefreshCallQueue=[]}},{key:"addAfterRefreshCallback",value:function addAfterRefreshCallback(callback){if(Util.isFunction(callback)){this.afterRefreshCallQueue.push(callback)}}},{key:"setState",value:function setState(refName,value,update){if(Util.isString(refName)&&Util.isFunction(value)){this.state[refName]=value(this.state[refName])}else if(Util.isString(refName)&&Util.isObject(value)){this.state[refName]=value}else{var state={};if(Util.isFunction(refName))state=refName(this.state);else if(Util.isObject(refName))state=refName;for(var p in state){if(state.hasOwnProperty(p))this.state[p]=state[p]}}if(update!==false)this.refreshApp()}},{key:"getState",value:function getState(refName){if(Util.isString(refName)){return!Util.isEmpty(this.state[refName])?this.state[refName]:{}}else if(Util.isEmpty(refName)){return this.state}}},{key:"isStateEmpty",value:function isStateEmpty(refName){refName=Util.isString(refName)?refName:refName.stateRef;return this.recursiveCheckMapIsEmpty(Util.isEmpty(refName)?this.state:this.state[refName])}},{key:"recursiveCheckMapIsEmpty",value:function recursiveCheckMapIsEmpty(map){for(var key in map){if(map.hasOwnProperty(key)){if(Util.notEmpty(map[key]))return false;if(Util.isObject(map[key]))this.recursiveCheckMapIsEmpty(map[key])}}return true}},{key:"clearState",value:function clearState(refName,update){refName=Util.isString(refName)?refName:refName.stateRef;this.recursiveClearMap(this.state[refName]||this.state);if(update!==false){this.refreshApp()}}},{key:"recursiveClearMap",value:function recursiveClearMap(map){var _this3=this;Object.keys(map).forEach(function(key){if(Util.isArray(map[key]))map[key]=[];else if(Util.isObject(map[key]))_this3.recursiveClearMap(map[key]);else map[key]=""})}},{key:"mergeState",value:function mergeState(refName,value,update){var newState={};if(Util.isString(refName)&&Util.isFunction(value)){newState[refName]=value(this.state[refName])}else if(Util.isString(refName)&&Util.isObject(value)){newState[refName]=value}else{var state={};if(Util.isFunction(refName))state=refName(this.state);else if(Util.isObject(refName))state=refName;for(var p in state){if(state.hasOwnProperty(p))newState[p]=state[p]}}this.recursiveMergeState(this.state,newState);if(update!==false)this.refreshApp()}},{key:"recursiveMergeState",value:function recursiveMergeState(oldMap,newMap){for(var key in newMap){if(newMap.hasOwnProperty(key)){if(Util.isArray(oldMap[key])&&!Util.isArray(newMap[key]))oldMap[key].push(newMap[key]);else if(Util.isArray(oldMap[key])&&Util.isArray(newMap[key]))oldMap[key]=oldMap[key].concat(newMap[key]);else if(Util.isObject(oldMap[key])&&Util.isObject(newMap[key]))this.recursiveMergeState(oldMap[key],newMap[key]);else oldMap[key]=newMap[key]}}}},{key:"setRouter",value:function setRouter(router){this.router=router}}]);return AppInstance}();return{name:App.name,root:App.root,create:App.create,get:App.get,component:App.component,setState:App.setState,getState:App.getState,clearState:App.clearState,isStateEmpty:App.isStateEmpty,mergeState:App.mergeState}}();var createApp=function(){return function(selector,component,appName){if(component.valueOf().name.length===0){throw new Error("The app function must be a named function.")}if(Util.isFunction(component)&&!RMEComponentManager.hasComponent(component.valueOf().name))Component(component);return App.name(appName).root(selector).create(_defineProperty({},component.valueOf().name,{}))}}();var useState=function(){return function(refName,value,update,appName){var name=Util.isString(update)?update:appName;var stateRef=Util.isString(refName)?refName:refName.stateRef;App.get(name).setState(stateRef,value,update);return App.get(name).getState(stateRef)}}();var useValue=function(){return function(value,appName){return ValueStore.useValue(value,appName)}}();var AppManager=function(){var AppManager=function(){function AppManager(){_classCallCheck(this,AppManager);this.apps={}}_createClass(AppManager,[{key:"set",value:function set(name,value){this.apps[name]=value}},{key:"get",value:function get(name){return this.apps[name]}}]);return AppManager}();var manager=new AppManager;return manager}();var RMEElemRenderer=function(){function RMEElemRenderer(root){_classCallCheck(this,RMEElemRenderer);this.root=root;this.mergedStage;this.tobeRemoved=[]}_createClass(RMEElemRenderer,[{key:"merge",value:function merge(oldStage,newStage){if(Util.isEmpty(this.root.getChildren())){this.root.append(newStage);this.mergedStage=newStage}else{this.render(this.root,oldStage,newStage,0);this.mergedStage=oldStage;this.removeToBeRemoved()}return this.mergedStage}},{key:"render",value:function render(parent,oldNode,newNode,index){if(!oldNode&&newNode){parent.append(newNode.duplicate())}else if(oldNode&&!newNode){this.tobeRemoved.push({parent:parent,child:this.wrap(parent.dom().children[index])})}else if(this.hasNodeChanged(oldNode,newNode)){if(oldNode.getTagName()!==newNode.getTagName()||oldNode.dom().children.length>0||newNode.dom().children.length>0){this.wrap(parent.dom().children[index]).replace(newNode.duplicate())}else{oldNode.setProps(newNode.getProps())}}else{var i=0;var oldLength=oldNode?oldNode.dom().children.length:0;var newLength=newNode?newNode.dom().children.length:0;while(i<newLength||i<oldLength){this.render(this.wrap(parent.dom().children[index]),oldNode?this.wrap(oldNode.dom().children[i]):null,newNode?this.wrap(newNode.dom().children[i]):null,i);i++}}}},{key:"removeToBeRemoved",value:function removeToBeRemoved(){if(this.tobeRemoved.length>0){var lastIdx=this.tobeRemoved.length-1;while(lastIdx>=0){this.tobeRemoved[lastIdx].parent.remove(this.tobeRemoved[lastIdx].child);lastIdx--}this.tobeRemoved=[]}}},{key:"hasNodeChanged",value:function hasNodeChanged(oldNode,newNode){return!Util.isEmpty(oldNode)&&!Util.isEmpty(newNode)&&oldNode.getProps(true)!==newNode.getProps(true)}},{key:"wrap",value:function wrap(node){if(!Util.isEmpty(node))return Elem.wrap(node)}}]);return RMEElemRenderer}();var ValueStore=function(){var ValueStore=function(){function ValueStore(){_classCallCheck(this,ValueStore);this.values={};this.valueRefGenerator=new RefGenerator("val")}_createClass(ValueStore,[{key:"useValue",value:function useValue(value,appName){var _this4=this;if(Util.isFunction(value)){value=value(value)}var ref=this.valueRefGenerator.next();this.values[ref]=value;var getter=function getter(){return _this4.values[ref]};var setter=function setter(next,update){if(Util.isFunction(next)){next=next(getter())}_this4.values[ref]=next;if(update!==false){App.get(appName).refresh()}};return[getter,setter]}}]);return ValueStore}();var RefGenerator=function(){function RefGenerator(feed){_classCallCheck(this,RefGenerator);this.feed=feed||"";this.seq=0}_createClass(RefGenerator,[{key:"next",value:function next(){var ref=this.feed+this.seq;this.seq++;return ref}}]);return RefGenerator}();var valueStore=new ValueStore;return valueStore}();var Browser=function(){function Browser(){_classCallCheck(this,Browser)}_createClass(Browser,null,[{key:"scrollTo",value:function scrollTo(xPos,yPos){window.scrollTo(xPos,yPos)}},{key:"scrollBy",value:function scrollBy(xPx,yPx){window.scrollBy(xPx,yPx)}},{key:"open",value:function open(url,name,specs,replace){return window.open(url,name,specs,replace)}},{key:"close",value:function close(openedWindow){openedWindow.close()}},{key:"print",value:function print(){window.print()}},{key:"alert",value:function alert(message){window.alert(message)}},{key:"confirm",value:function confirm(message){return window.confirm(message)}},{key:"prompt",value:function prompt(message,defaultText){return window.prompt(message,defaultText)}},{key:"mediaMatcher",value:function mediaMatcher(mediaString){if(mediaString.indexOf("(")!==0)mediaString="("+mediaString;if(mediaString.indexOf(")")!==mediaString.length-1)mediaString=mediaString+")";return window.matchMedia(mediaString)}},{key:"pageBack",value:function pageBack(){history.back()}},{key:"pageForward",value:function pageForward(){history.forward()}},{key:"pageGo",value:function pageGo(numberOfPagesOrUrl){history.go(numberOfPagesOrUrl)}},{key:"pushState",value:function pushState(stateObject,title,newURL){history.pushState(stateObject,title,newURL)}},{key:"replaceState",value:function replaceState(stateObject,title,newURL){history.replaceState(stateObject,title,newURL)}},{key:"newPage",value:function newPage(newURL){location.assign(newURL)}},{key:"reloadPage",value:function reloadPage(force){location.reload(force)}},{key:"replacePage",value:function replacePage(newURL){location.replace(newURL)}},{key:"getAnchorHash",value:function getAnchorHash(){return location.hash}},{key:"setAnchorHash",value:function setAnchorHash(hash){location.hash=hash}},{key:"getHostnamePort",value:function getHostnamePort(){return location.host}},{key:"setHostnamePort",value:function setHostnamePort(hostPort){location.host=hostPort}},{key:"getHostname",value:function getHostname(){return location.hostname}},{key:"setHostname",value:function setHostname(hostname){location.hostname=hostname}},{key:"getURL",value:function getURL(){return location.href}},{key:"setURL",value:function setURL(newURL){location.href=newURL}},{key:"getOrigin",value:function getOrigin(){return location.origin}},{key:"getPathname",value:function getPathname(){return location.pathname}},{key:"setPathname",value:function setPathname(pathname){location.pathname=pathname}},{key:"getPort",value:function getPort(){return location.port}},{key:"setPort",value:function setPort(portNumber){location.port=portNumber}},{key:"getProtocol",value:function getProtocol(){return location.protocol}},{key:"setProtocol",value:function setProtocol(protocol){location.protocol=protocol}},{key:"getSearchString",value:function getSearchString(){return location.search}},{key:"setSearchString",value:function setSearchString(searchString){location.search=searchString}},{key:"getCodename",value:function getCodename(){return navigator.appCodeName}},{key:"getName",value:function getName(){return navigator.appName}},{key:"getVersion",value:function getVersion(){return navigator.appVersion}},{key:"isCookiesEnabled",value:function isCookiesEnabled(){return navigator.cookieEnabled}},{key:"getGeoLocation",value:function getGeoLocation(){return navigator.geolocation}},{key:"getLanguage",value:function getLanguage(){return navigator.language}},{key:"getPlatform",value:function getPlatform(){return navigator.platform}},{key:"getProduct",value:function getProduct(){return navigator.product}},{key:"getUserAgentHeader",value:function getUserAgentHeader(){return navigator.userAgent}},{key:"getColorDepth",value:function getColorDepth(){return screen.colorDepth}},{key:"getFullScreenHeight",value:function getFullScreenHeight(){return screen.height}},{key:"getFullScreenWidth",value:function getFullScreenWidth(){return screen.width}},{key:"getAvailableScreenHeight",value:function getAvailableScreenHeight(){return screen.availHeight}},{key:"getAvailableScreenWidth",value:function getAvailableScreenWidth(){return screen.availWidth}}]);return Browser}();var AppSetInitialStateJob=function(){var InitStateJob=function(){function InitStateJob(){_classCallCheck(this,InitStateJob);this.updateJob;this.updateJobMap={};this.appNameList=[]}_createClass(InitStateJob,[{key:"resolveUpdateJobs",value:function resolveUpdateJobs(){var _this5=this;if(!this.updateJob)this.updateJob=Util.setInterval(function(){var appName=_this5.getAppNameIfPresent();if(!Util.isEmpty(appName)){_this5.updateJobMap[appName].forEach(function(job){return job()});_this5.updateJobMap[appName]=[];_this5.appNameList=_this5.appNameList.filter(function(app){return app!==appName});if(_this5.appNameList.length===0){Util.clearInterval(_this5.updateJob);_this5.updateJob=undefined}}})}},{key:"getAppNameIfPresent",value:function getAppNameIfPresent(){return this.appNameList.find(function(appName){return App.get(appName==="undefined"?undefined:appName)})}},{key:"addToQueue",value:function addToQueue(appName,job){var updateQueue=this.updateJobMap[appName]||[];updateQueue.push(job);this.updateJobMap[appName]=updateQueue;this.appNameList=Object.keys(this.updateJobMap);this.resolveUpdateJobs()}}]);return InitStateJob}();var initStateJob=new InitStateJob;return{addToQueue:initStateJob.addToQueue.bind(initStateJob),resolveUpdateJobs:initStateJob.resolveUpdateJobs.bind(initStateJob)}}();var Component=function(){var resolveInitialState=function resolveInitialState(initialState,stateRef,appName){if(!Util.isEmpty(App.get(appName))){App.get(appName).setState(stateRef,initialState,false)}else{AppSetInitialStateJob.addToQueue(appName,function(){return App.get(appName).setState(stateRef,initialState)})}};var resolveComponent=function resolveComponent(component){if(Util.isObject(component)){App.component(_defineProperty({},component.name,component.comp))(component.appName);resolveInitialState(component.initialState,component.name+component.stateRef,component.appName)}else if(Util.isFunction(component)&&Util.isEmpty(component.prototype)||Util.isEmpty(component.prototype.render)){RMEComponentManager.addComponent(_defineProperty({},component.valueOf().name,component))}else if(Util.isFunction(component)&&!Util.isEmpty(component.prototype.render)){var comp=new component;App.component(_defineProperty({},component.valueOf().name,comp.render))(comp.appName);var state={};if(!Util.isEmpty(comp.onBeforeCreate))state.onBeforeCreate=comp.onBeforeCreate;if(!Util.isEmpty(comp.shouldComponentUpdate))state.shouldComponentUpdate=comp.shouldComponentUpdate;if(!Util.isEmpty(comp.onAfterCreate))state.onAfterCreate=comp.onAfterCreate;if(!Util.isEmpty(comp.onAfterRender))state.onAfterRender=comp.onAfterRender;state=_objectSpread({},state,{},comp.initialState);var ref=comp.stateRef||state.stateRef||"";resolveInitialState(state,component.name+ref,comp.appName)}};return function(){for(var _len=arguments.length,components=new Array(_len),_key=0;_key<_len;_key++){components[_key]=arguments[_key]}components.forEach(function(component){return!Util.isEmpty(component.valueOf().name)&&resolveComponent(component)})}}();var bindState=function(){var getStateRef=function getStateRef(state){return state&&state.stateRef?state.stateRef:""};var removeStateRef=function removeStateRef(state){var obj=_objectSpread({},state);delete obj.stateRef;return obj};return function(component,state,appName){return{comp:component,name:component.valueOf().name,appName:appName,stateRef:getStateRef(state),initialState:_objectSpread({},removeStateRef(state))}}}();var bindGetters=function(){return function(component,mapper){var name;if(Util.isFunction(component))name=component.valueOf().name;else if(Util.isObject(component)){name=component.name}RMEComponentManager.bindGetters(name,mapper);return component}}();var RMEComponentManager=function(){var RMEComponentManager=function(){function RMEComponentManager(){_classCallCheck(this,RMEComponentManager);this.components={};this.componentGetters={}}_createClass(RMEComponentManager,[{key:"addComponent",value:function addComponent(component,props){var _this6=this;if(Util.isFunction(component)){component=component.call()}Object.keys(component).forEach(function(p){_this6.components[p]={component:component[p],update:Util.isFunction(props)?props:undefined}})}},{key:"getComponent",value:function getComponent(name,props){var comp=this.components[name];if(!comp){throw new Error("Cannot find a component: \"".concat(name,"\""))}if(Util.notEmpty(props)&&Util.isFunction(comp.update)){var stateRef=props.stateRef;if(Util.isEmpty(props.stateRef))stateRef=name;else if(props.stateRef.search(name)===-1)stateRef="".concat(name).concat(props.stateRef);props["stateRef"]=stateRef;var newProps=comp.update.call()(stateRef);var nextProps=_objectSpread({},props,{},newProps);if(!nextProps.shouldComponentUpdate||nextProps.shouldComponentUpdate(nextProps)!==false){props=this.extendProps(props,newProps)}}if(Util.isEmpty(props))props={};this.inflateGetterValues(name,props);if(Util.notEmpty(props.onBeforeCreate)&&Util.isFunction(props.onBeforeCreate))props.onBeforeCreate.call(props,props);var ret=comp.component.call(props,props);if(Template.isTemplate(ret))ret=Template.resolve(ret);if(Util.notEmpty(props.onAfterCreate)&&Util.isFunction(props.onAfterCreate))props.onAfterCreate.call(props,ret,props);if(Util.notEmpty(this.defaultApp)&&Util.notEmpty(props.onAfterRender)&&Util.isFunction(props.onAfterRender))this.defaultApp.addAfterRefreshCallback(props.onAfterRender.bind(ret,ret,props));return ret}},{key:"inflateGetterValues",value:function inflateGetterValues(component,props){var mapper=this.getGetters(component);if(Util.notEmpty(mapper)){var p=Object.keys(mapper).reduce(function(prev,curr){prev[curr]=Util.isFunction(mapper[curr])?mapper[curr]():mapper[curr];return prev},{});this.extendProps(props,p)}}},{key:"extendProps",value:function extendProps(props,newProps){if(Util.notEmpty(newProps)){Object.keys(newProps).forEach(function(key){return props[key]=newProps[key]})}return props}},{key:"hasComponent",value:function hasComponent(name){return Util.notEmpty(this.components[name.replace("component:","")])}},{key:"bindGetters",value:function bindGetters(component,getters){this.componentGetters[component]=getters}},{key:"getGetters",value:function getGetters(component){return this.componentGetters[component]}}]);return RMEComponentManager}();var manager=new RMEComponentManager;return manager}();var Cookie=function(){var Cookie=function(){function Cookie(){_classCallCheck(this,Cookie)}_createClass(Cookie,null,[{key:"get",value:function get(name){if(navigator.cookieEnabled){var retCookie=null;var cookies=document.cookie.split(";");var i=0;while(i<cookies.length){var cookie=cookies[i];var eq=cookie.search("=");var cn=cookie.substr(0,eq).trim();var cv=cookie.substr(eq+1,cookie.length).trim();if(cn===name){retCookie=new CookieInstance(cn,cv);break}i++}return retCookie}}},{key:"set",value:function set(name,value,expiresDate,cookiePath,cookieDomain,setSecureBoolean){if(navigator.cookieEnabled){document.cookie=CookieInstance.create(name,value,expiresDate,cookiePath,cookieDomain,setSecureBoolean).toString()}}},{key:"remove",value:function remove(name){var co=Cookie.get(name);if(!Util.isEmpty(co)){co.setExpired();document.cookie=co.toString()}}}]);return Cookie}();var CookieInstance=function(){function CookieInstance(name,value,expiresDate,cookiePath,cookieDomain,setSecureBoolean){_classCallCheck(this,CookieInstance);this.cookieName=!Util.isEmpty(name)&&Util.isString(name)?name.trim():"";this.cookieValue=!Util.isEmpty(value)&&Util.isString(value)?value.trim():"";this.cookieExpires=!Util.isEmpty(expiresDate)&&Util.isString(expiresDate)?expiresDate.trim():"";this.cookiePath=!Util.isEmpty(cookiePath)&&Util.isString(cookiePath)?cookiePath.trim():"";this.cookieDomain=!Util.isEmpty(cookieDomain)&&Util.isString(cookieDomain)?cookieDomain.trim():"";this.cookieSecurity=!Util.isEmpty(setSecureBoolean)&&Util.isBoolean(setSecureBoolean)?"secure=secure":""}_createClass(CookieInstance,[{key:"setExpired",value:function setExpired(){this.cookieExpires=new Date(1970,0,1).toString()}},{key:"toString",value:function toString(){return this.cookieName+"="+this.cookieValue+"; expires="+this.cookieExpires+"; path="+this.cookiePath+"; domain="+this.cookieDomain+"; "+this.cookieSecurity}}],[{key:"create",value:function create(name,value,expires,cpath,cdomain,setSecure){return new CookieInstance(name,value,expires,cpath,cdomain,setSecure)}}]);return CookieInstance}();return Cookie}();var CSS=function(){var getStyles=function getStyles(config){var styles=Tree.getHead().getByTag("style");if(Util.isEmpty(config)&&!Util.isArray(styles)){return styles}else if(Util.isArray(styles)){return styles.find(function(style){return arePropertiesSame(style.getProps(),config)})}else if(!Util.isEmpty(styles)&&arePropertiesSame(styles.getProps(),config)){return styles}};var propsWithoutContent=function propsWithoutContent(props){var newProps=_objectSpread({},props);delete newProps.text;return newProps};var arePropertiesSame=function arePropertiesSame(oldProps,newProps){return JSON.stringify(propsWithoutContent(oldProps))===JSON.stringify(newProps||{})};var hasStyles=function hasStyles(config){return!Util.isEmpty(getStyles(config))};var hasContent=function hasContent(content,config){var styles=getStyles(config);if(!Util.isEmpty(styles)){return styles.getContent().match(content)!==null}};return function(content,config){if(!hasStyles(config)){Tree.getHead().append({style:_objectSpread({content:content},config)})}else if(!hasContent(content,config)){var style=getStyles(config);if(!Util.isEmpty(style)){var prevContent=style.getContent();style.setContent(prevContent+content)}}}}();var Elem=function(){var Elem=function(){function Elem(type){_classCallCheck(this,Elem);if(Util.isString(type)){this.html=document.createElement(type)}else if(type.nodeType!==undefined&&type.ownerDocument!==undefined&&type.nodeType>=1&&type.ownerDocument instanceof HTMLDocument){this.html=type}else{throw"type must be a string or a HTMLDocument"}}_createClass(Elem,[{key:"setText",value:function setText(text){if(this.html.hasChildNodes()){this.html.replaceChild(document.createTextNode(text),this.html.childNodes[0])}else{this.html.appendChild(document.createTextNode(text))}return this}},{key:"getText",value:function getText(){var text="";this.html.childNodes.forEach(function(node){if(node.nodeType===3){text=node.nodeValue}});return text}},{key:"getContent",value:function getContent(){return this.html.innerHTML}},{key:"setContent",value:function setContent(html){this.html.innerHTML=html;return this}},{key:"setValue",value:function setValue(value){this.html.value=value;return this}},{key:"getValue",value:function getValue(){return this.html.value}},{key:"setId",value:function setId(id){this.html.id=id;return this}},{key:"getId",value:function getId(){return this.html.id}},{key:"append",value:function append(elem){if(!Util.isEmpty(elem))this.html.appendChild(Template.isTemplate(elem)?Template.resolve(elem).dom():elem.dom());return this}},{key:"remove",value:function remove(elem){this.html.removeChild(elem.dom());return this}},{key:"replace",value:function replace(newElem){this.html.parentElement.replaceChild(newElem.dom(),this.html);return this}},{key:"before",value:function before(newElem){this.html.parentElement.insertBefore(newElem.dom(),this.html);return this}},{key:"after",value:function after(newElem){if(this.html.nextElementSibling!==null)this.html.parentElement.insertBefore(newElem.dom(),this.html.nextElementSibling);else this.html.parentElement.appendChild(newElem.dom());return this}},{key:"toString",value:function toString(){return"<"+this.getTagName().toLowerCase()+">"+this.getContent()+"</"+this.getTagName().toLowerCase()+">"}},{key:"toLiteralString",value:function toLiteralString(){return RMEElemTemplater.toLiteralString(this)}},{key:"toTemplate",value:function toTemplate(deep){return RMEElemTemplater.toTemplate(this,deep)}},{key:"getProps",value:function getProps(json){if(Util.isBoolean(json)&&json===true)return JSON.stringify(RMEElemTemplater.getElementProps(this));else return RMEElemTemplater.getElementProps(this)}},{key:"setProps",value:function setProps(props){Template.updateElemProps(this,props,this.getProps());return this}},{key:"render",value:function render(){var newState=[];var i=0;for(var _len2=arguments.length,elems=new Array(_len2),_key2=0;_key2<_len2;_key2++){elems[_key2]=arguments[_key2]}var max=elems.length;while(i<max){if(Util.isArray(elems[i]))newState=newState.concat(elems[i]);else newState.push(elems[i]);i++}if(!RenderHelper.isNewStateEqualToPrevState(newState)){RenderHelper.setPrevState(null);while(this.html.firstChild){this.html.removeChild(this.html.firstChild)}i=0;max=newState.length;while(i<max){if(!Util.isEmpty(newState[i]))this.append(newState[i]);i++}}RenderHelper.setPrevState(newState);return this}},{key:"getChildren",value:function getChildren(){return Elem.wrapElems(this.html.children)}},{key:"get",value:function get(selector){return Elem.wrapElems(this.html.querySelectorAll(selector))}},{key:"getFirst",value:function getFirst(selector){try{return Elem.wrap(this.html.querySelector(selector))}catch(e){}}},{key:"getByTag",value:function getByTag(tag){return Elem.wrapElems(this.html.getElementsByTagName(tag))}},{key:"getByClass",value:function getByClass(classname){return Elem.wrapElems(this.html.getElementsByClassName(classname))}},{key:"setTitle",value:function setTitle(text){this.html.title=text;return this}},{key:"getTitle",value:function getTitle(){return this.html.title}},{key:"setTabIndex",value:function setTabIndex(idx){this.setAttribute("tabindex",idx);return this}},{key:"getTabIndex",value:function getTabIndex(){return this.getAttribute("tabindex")}},{key:"getTagName",value:function getTagName(){return this.html.tagName}},{key:"setAttribute",value:function setAttribute(attr,value){var attribute=document.createAttribute(attr);attribute.value=value;this.html.setAttributeNode(attribute);return this}},{key:"getAttribute",value:function getAttribute(attr){return this.html.getAttribute(attr)}},{key:"removeAttribute",value:function removeAttribute(attr){var attrNode=this.html.getAttributeNode(attr);if(attrNode)this.html.removeAttributeNode(attrNode);return this}},{key:"setName",value:function setName(name){this.setAttribute("name",name);return this}},{key:"getName",value:function getName(){return this.getAttribute("name")}},{key:"setType",value:function setType(type){this.setAttribute("type",type);return this}},{key:"getType",value:function getType(){return this.getAttribute("type")}},{key:"setSource",value:function setSource(source){this.setAttribute("src",source);return this}},{key:"getSource",value:function getSource(){return this.getAttribute("src")}},{key:"setHref",value:function setHref(href){this.setAttribute("href",href);return this}},{key:"getHref",value:function getHref(){return this.getAttribute("href")}},{key:"setPlaceholder",value:function setPlaceholder(placeholder){this.setAttribute("placeholder",placeholder);return this}},{key:"getPlaceholder",value:function getPlaceholder(){return this.getAttribute("placeholder")}},{key:"setSize",value:function setSize(size){this.setAttribute("size",size);return this}},{key:"getSize",value:function getSize(){return this.getAttribute("size")}},{key:"setMaxLength",value:function setMaxLength(length){this.setAttribute("maxlength",length);return this}},{key:"getMaxLength",value:function getMaxLength(){return this.getAttribute("maxlength")}},{key:"setMinLength",value:function setMinLength(length){this.setAttribute("minlength",length);return this}},{key:"getMinLength",value:function getMinLength(){return this.getAttribute("minlength")}},{key:"setData",value:function setData(key,value){this.html.dataset[key]=value;return this}},{key:"getData",value:function getData(key){return this.html.dataset[key]}},{key:"setEditable",value:function setEditable(_boolean){this.setAttribute("contenteditable",_boolean);return this}},{key:"getEditable",value:function getEditable(){return this.getAttribute("contenteditable")}},{key:"setDisabled",value:function setDisabled(_boolean2){if(Util.isBoolean(_boolean2)&&_boolean2===true||Util.isString(_boolean2)&&_boolean2==="disabled"){this.setAttribute("disabled","disabled")}else{this.removeAttribute("disabled")}return this}},{key:"getDisabled",value:function getDisabled(){return this.getAttribute("disabled")}},{key:"setChecked",value:function setChecked(_boolean3){if(Util.isBoolean(_boolean3)&&_boolean3===true||Util.isString(_boolean3)&&_boolean3==="checked"){this.setAttribute("checked","checked");this.html.checked=true}else{this.removeAttribute("checked");this.html.checked=false}return this}},{key:"getChecked",value:function getChecked(){return this.getAttribute("checked")}},{key:"setSelected",value:function setSelected(_boolean4){if(Util.isBoolean(_boolean4)&&_boolean4===true||Util.isString(_boolean4)&&_boolean4==="selected"){this.setAttribute("selected","selected")}else{this.removeAttribute("selected")}return this}},{key:"getSelected",value:function getSelected(){return this.getAttribute("selected")}},{key:"addClasses",value:function addClasses(classes){var addClassesArray=classes.trim().split(" ");var origClassName=this.getClasses();var origClassesArray=origClassName.split(" ");addClassesArray=addClassesArray.filter(function(clazz){return origClassName.match(clazz)===null});this.html.className=origClassesArray.concat(addClassesArray).join(" ").trim();return this}},{key:"updateClasses",value:function updateClasses(classes){this.addClasses(classes);var origClassName=this.getClasses();var origClassesArray=origClassName.split(" ");var updateClassesArray=[];classes.trim().split(" ").forEach(function(clazz){if(origClassesArray.filter(function(cl){return cl===clazz}).length>0)updateClassesArray.push(clazz)});this.html.className=updateClassesArray.join(" ").trim();return this}},{key:"removeClasses",value:function removeClasses(classes){var toRm=classes.trim().split(" ");var origClass="".concat(this.getClasses());var i=0;while(i<toRm.length){var clazz=toRm[i];if(origClass.match("".concat(clazz))!==null)origClass=origClass.replace(clazz,"").trim();i++}this.html.className=origClass.trim();return this}},{key:"toggleClasses",value:function toggleClasses(classes){var cArr=classes.split(" ");var origClass="".concat(this.getClasses());var toAdd="";var toRm="";var i=0;while(i<cArr.length){if(origClass.match("".concat(cArr[i]))!==null)toRm+=" "+cArr[i];else toAdd+=" "+cArr[i];i++}this.addClasses(toAdd.trim());this.removeClasses(toRm.trim());return this}},{key:"getClasses",value:function getClasses(){return this.html.className}},{key:"setStyles",value:function setStyles(styleMap){for(var style in styleMap){if(styleMap.hasOwnProperty(style))this.html.style[style]=styleMap[style]}return this}},{key:"getStyle",value:function getStyle(styleName){return this.html.style[styleName]}},{key:"setVisible",value:function setVisible(_boolean5){this.html.style.visibility=_boolean5?"":"hidden";return this}},{key:"display",value:function display(_boolean6){this.html.style.display=_boolean6?"":"none";return this}},{key:"setDraggable",value:function setDraggable(_boolean7){this.setAttribute("draggable",_boolean7);return this}},{key:"message",value:function message(_message){var i=0;var paramArray=[];for(var _len3=arguments.length,params=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){params[_key3-1]=arguments[_key3]}while(i<params.length){if(Util.isArray(params[i]))paramArray=paramArray.concat(params[i]);else paramArray.push(params[i]);i++}paramArray.push(this);this.setText(Messages.message(_message,paramArray));return this}},{key:"click",value:function click(){var _this7=this;Util.setTimeout(function(){return _this7.html.click()});return this}},{key:"focus",value:function focus(){var _this8=this;Util.setTimeout(function(){return _this8.html.focus()});return this}},{key:"blur",value:function blur(){var _this9=this;Util.setTimeout(function(){return _this9.html.blur()});return this}},{key:"clone",value:function clone(deep){return Elem.wrap(this.html.cloneNode(deep))}},{key:"dom",value:function dom(){return this.html}},{key:"duplicate",value:function duplicate(){return Template.resolve(this.toTemplate())}},{key:"height",value:function height(){return this.html.height}},{key:"width",value:function width(){return this.html.width}},{key:"top",value:function top(){return this.html.offsetTop}},{key:"left",value:function left(){return this.html.offsetLeft}},{key:"parent",value:function parent(){return this.html.parentElement!==null?Elem.wrap(this.html.parentElement):null}},{key:"next",value:function next(){return this.html.nextElementSibling!==null?Elem.wrap(this.html.nextElementSibling):null}},{key:"previous",value:function previous(){return this.html.previousElementSibling!==null?Elem.wrap(this.html.previousElementSibling):null}},{key:"getFirstChild",value:function getFirstChild(){return this.html.firstElementChild!==null?Elem.wrap(this.html.firstElementChild):null}},{key:"getLastChild",value:function getLastChild(){return this.html.lastElementChild!==null?Elem.wrap(this.html.lastElementChild):null}},{key:"extend",value:function extend(child){child.prototype=this;child.prototype.constructor=child;return child}},{key:"onAnimationStart",value:function onAnimationStart(handler){this.html.onanimationstart=handler;return this}},{key:"onAnimationIteration",value:function onAnimationIteration(handler){this.html.onanimationiteration=handler;return this}},{key:"onAnimationEnd",value:function onAnimationEnd(handler){this.html.onanimationend=handler;return this}},{key:"onTransitionEnd",value:function onTransitionEnd(handler){this.html.ontransitionend=handler;return this}},{key:"onDrag",value:function onDrag(handler){this.html.ondrag=handler;return this}},{key:"onDragEnd",value:function onDragEnd(handler){this.html.ondragend=handler;return this}},{key:"onDragEnter",value:function onDragEnter(handler){this.html.ondragenter=handler;return this}},{key:"onDragOver",value:function onDragOver(handler){this.html.ondragover=handler;return this}},{key:"onDragStart",value:function onDragStart(handler){this.html.ondragstart=handler;return this}},{key:"onDrop",value:function onDrop(handler){this.html.ondrop=handler;return this}},{key:"onClick",value:function onClick(handler){this.html.onclick=handler;return this}},{key:"onDoubleClick",value:function onDoubleClick(handler){this.html.ondblclick=handler;return this}},{key:"onContextMenu",value:function onContextMenu(handler){this.html.oncontextmenu=handler;return this}},{key:"onMouseDown",value:function onMouseDown(handler){this.html.onmousedown=handler;return this}},{key:"onMouseEnter",value:function onMouseEnter(handler){this.html.onmouseenter=handler;return this}},{key:"onMouseLeave",value:function onMouseLeave(handler){this.html.onmouseleave=handler;return this}},{key:"onMouseMove",value:function onMouseMove(handler){this.html.onmousemove=handler;return this}},{key:"onMouseOver",value:function onMouseOver(handler){this.html.onmouseover=handler;return this}},{key:"onMouseOut",value:function onMouseOut(handler){this.html.onmouseout=handler;return this}},{key:"onMouseUp",value:function onMouseUp(handler){this.html.onmouseup=handler;return this}},{key:"onWheel",value:function onWheel(handler){this.html.onwheel=handler;return this}},{key:"onScroll",value:function onScroll(handler){this.html.onscroll=handler;return this}},{key:"onResize",value:function onResize(handler){this.html.onresize=handler;return this}},{key:"onError",value:function onError(handler){this.html.onerror=handler;return this}},{key:"onLoad",value:function onLoad(handler){this.html.onload=handler;return this}},{key:"onUnload",value:function onUnload(handler){this.html.onunload=handler;return this}},{key:"onBeforeUnload",value:function onBeforeUnload(handler){this.html.onbeforeunload=handler;return this}},{key:"onKeyUp",value:function onKeyUp(handler){this.html.onkeyup=handler;return this}},{key:"onKeyDown",value:function onKeyDown(handler){this.html.onkeydown=handler;return this}},{key:"onKeyPress",value:function onKeyPress(handler){this.html.onkeypress=handler;return this}},{key:"onInput",value:function onInput(handler){this.html.oninput=handler;return this}},{key:"onChange",value:function onChange(handler){this.html.onchange=handler;return this}},{key:"onSubmit",value:function onSubmit(handler){this.html.onsubmit=handler;return this}},{key:"onSelect",value:function onSelect(handler){this.html.onselect=handler;return this}},{key:"onReset",value:function onReset(handler){this.html.onreset=handler;return this}},{key:"onFocus",value:function onFocus(handler){this.html.onfocus=handler;return this}},{key:"onFocusIn",value:function onFocusIn(handler){this.html.onfocusin=handler;return this}},{key:"onFocusOut",value:function onFocusOut(handler){this.html.onfocusout=handler;return this}},{key:"onBlur",value:function onBlur(handler){this.html.onblur=handler;return this}},{key:"onCopy",value:function onCopy(handler){this.html.oncopy=handler;return this}},{key:"onCut",value:function onCut(handler){this.html.oncut=handler;return this}},{key:"onPaste",value:function onPaste(handler){this.html.onpaste=handler;return this}},{key:"onAbort",value:function onAbort(handler){this.html.onabort=handler;return this}},{key:"onWaiting",value:function onWaiting(handler){this.html.onwaiting=handler;return this}},{key:"onVolumeChange",value:function onVolumeChange(handler){this.html.onvolumechange=handler;return this}},{key:"onTimeUpdate",value:function onTimeUpdate(handler){this.html.ontimeupdate=handler;return this}},{key:"onSeeking",value:function onSeeking(handler){this.html.onseeking=handler;return this}},{key:"onSeekEnd",value:function onSeekEnd(handler){this.html.onseekend=handler;return this}},{key:"onRateChange",value:function onRateChange(handler){this.html.onratechange=handler;return this}},{key:"onProgress",value:function onProgress(handler){this.html.onprogress=handler;return this}},{key:"onLoadMetadata",value:function onLoadMetadata(handler){this.html.onloadmetadata=handler;return this}},{key:"onLoadedData",value:function onLoadedData(handler){this.html.onloadeddata=handler;return this}},{key:"onLoadStart",value:function onLoadStart(handler){this.html.onloadstart=handler;return this}},{key:"onPlaying",value:function onPlaying(handler){this.html.onplaying=handler;return this}},{key:"onPlay",value:function onPlay(handler){this.html.onplay=handler;return this}},{key:"onPause",value:function onPause(handler){this.html.onpause=handler;return this}},{key:"onEnded",value:function onEnded(handler){this.html.onended=handler;return this}},{key:"onDurationChange",value:function onDurationChange(handler){this.html.ondurationchange=handler;return this}},{key:"onCanPlay",value:function onCanPlay(handler){this.html.oncanplay=handler;return this}},{key:"onCanPlayThrough",value:function onCanPlayThrough(handler){this.html.oncanplaythrough=handler;return this}},{key:"onStalled",value:function onStalled(handler){this.html.onstalled=handler;return this}},{key:"onSuspend",value:function onSuspend(handler){this.html.onsuspend=handler;return this}},{key:"onPopState",value:function onPopState(handler){this.html.onpopstate=handler;return this}},{key:"onStorage",value:function onStorage(handler){this.html.onstorage=handler;return this}},{key:"onHashChange",value:function onHashChange(handler){this.html.onhashchange=handler;return this}},{key:"onAfterPrint",value:function onAfterPrint(handler){this.html.onafterprint=handler;return this}},{key:"onBeforePrint",value:function onBeforePrint(handler){this.html.onbeforeprint=handler;return this}},{key:"onPageHide",value:function onPageHide(handler){this.html.onpagehide=handler;return this}},{key:"onPageShow",value:function onPageShow(handler){this.html.onpageshow=handler;return this}}],[{key:"create",value:function create(type){return new Elem(type)}},{key:"wrap",value:function wrap(html){if(!Util.isEmpty(html))return new Elem(html);else throw"Could not wrap a html element - html: "+html}},{key:"wrapElems",value:function wrapElems(htmlDoc){var eArr=[];var i=0;while(i<htmlDoc.length){eArr.push(Elem.wrap(htmlDoc[i]));i++}return eArr.length===1?eArr[0]:eArr}}]);return Elem}();var RenderHelper=function(){function RenderHelper(){_classCallCheck(this,RenderHelper);this.instance;this.prevState=[];this.prevStateString=""}_createClass(RenderHelper,null,[{key:"setPrevState",value:function setPrevState(state){RenderHelper.getInstance().prevState=state;RenderHelper.getInstance().prevStateString=Util.isEmpty(state)?"":state.toString()}},{key:"getPrevState",value:function getPrevState(){return RenderHelper.getInstance().prevState}},{key:"isNewStateEqualToPrevState",value:function isNewStateEqualToPrevState(newState){return RenderHelper.getInstance().prevStateString===newState.toString()}},{key:"getInstance",value:function getInstance(){if(!this.instance)this.instance=new RenderHelper;return this.instance}}]);return RenderHelper}();return Elem}();var RMEElemTemplater=function(){function RMEElemTemplater(){_classCallCheck(this,RMEElemTemplater);this.instance;this.template={};this.deep=true}_createClass(RMEElemTemplater,[{key:"toTemplate",value:function toTemplate(elem,deep){if(!Util.isEmpty(deep))this.deep=deep;this.resolve(elem,this.template);return this.template}},{key:"resolve",value:function resolve(elem,parent){var resolved=this.resolveElem(elem,this.resolveProps(elem));for(var p in parent){if(parent.hasOwnProperty(p)){if(Util.isArray(parent[p]._rme_type_))parent[p]._rme_type_.push(resolved);else this.extendMap(parent[p],resolved)}}var i=0;var children=Util.isArray(elem.getChildren())?elem.getChildren():[elem.getChildren()];if(children&&this.deep){while(i<children.length){this.resolve(children[i],resolved);i++}}this.template=resolved}},{key:"extendMap",value:function extendMap(map,next){for(var v in next){if(next.hasOwnProperty(v)){map[v]=next[v]}}}},{key:"resolveElem",value:function resolveElem(elem,props){var el={};var children=elem.getChildren();if(Util.isArray(children)&&children.length>1){var elTag=elem.getTagName().toLowerCase();var elName=this.resolveId(elTag,props);elName=this.resolveClass(elName,props);elName=this.resolveAttrs(elName,props);el[elName]={_rme_type_:[],_rme_props_:props}}else{el[elem.getTagName().toLowerCase()]=props}return el}},{key:"resolveId",value:function resolveId(tag,props){if(props.id)return tag+"#"+props.id;else return tag}},{key:"resolveClass",value:function resolveClass(tag,props){if(props["class"])return tag+"."+props["class"].replace(/ /g,".");else return tag}},{key:"resolveAttrs",value:function resolveAttrs(tag,props){var tagName=tag;for(var p in props){if(props.hasOwnProperty(p)&&p!=="id"&&p!=="class"&&p.indexOf("on")!==0){tagName+="[".concat(p,"=").concat(props[p],"]")}}return tagName}},{key:"resolveProps",value:function resolveProps(elem){var props={};var attributes=elem.dom().attributes;var a=0;if(attributes){while(a<attributes.length){props[this.resolveAttributeNames(attributes[a].name)]=attributes[a].value;a++}}if(elem.dom().hasChildNodes()&&elem.dom().childNodes[0].nodeType===3){props["text"]=elem.getText()}for(var p in elem.dom()){if(p.indexOf("on")!==0||Util.isEmpty(elem.dom()[p]))continue;else props[this.resolveListeners(p)]=elem.dom()[p]}return props}},{key:"resolveAttributeNames",value:function resolveAttributeNames(attrName){if(attrName.indexOf("data"===0&&attrName.length>"data".length)){while(attrName.search("-")>-1){attrName=attrName.replace(/-\w/,attrName.charAt(attrName.search("-")+1).toUpperCase())}return attrName}else{return attrName}}},{key:"resolveListeners",value:function resolveListeners(name){switch(name){case"onanimationstart":return"onAnimationStart";case"onanimationiteration":return"onAnimationIteration";case"onanimationend":return"onAnimationEnd";case"ontransitionend":return"onTransitionEnd";case"ondrag":return"onDrag";case"ondragend":return"onDragEnd";case"ondragenter":return"onDragEnter";case"ondragover":return"onDragOver";case"ondragstart":return"onDragStart";case"ondrop":return"onDrop";case"onclick":return"onClick";case"ondblclick":return"onDoubleClick";case"oncontextmenu":return"onContextMenu";case"onmousedown":return"onMouseDown";case"onmouseenter":return"onMouseEnter";case"onmouseleave":return"onMouseLeave";case"onmousemove":return"onMouseMove";case"onmouseover":return"onMouseOver";case"onmouseout":return"onMouseOut";case"onmouseup":return"onMouseUp";case"onwheel":return"onWheel";case"onscroll":return"onScroll";case"onresize":return"onResize";case"onerror":return"onError";case"onload":return"onLoad";case"onunload":return"onUnload";case"onbeforeunload":return"onBeforeUnload";case"onkeyup":return"onKeyUp";case"onkeydown":return"onKeyDown";case"onkeypress":return"onKeyPress";case"oninput":return"onInput";case"onchange":return"onChange";case"onsubmit":return"onSubmit";case"onselect":return"onSelect";case"onreset":return"onReset";case"onfocus":return"onFocus";case"onfocusin":return"onFocusIn";case"onfocusout":return"onFocusOut";case"onblur":return"onBlur";case"oncopy":return"onCopy";case"oncut":return"onCut";case"onpaste":return"onPaste";case"onabort":return"onAbort";case"onwaiting":return"onWaiting";case"onvolumechange":return"onVolumeChange";case"ontimeupdate":return"onTimeUpdate";case"onseeking":return"onSeeking";case"onseekend":return"onSeekEnd";case"onratechange":return"onRateChange";case"onprogress":return"onProgress";case"onloadmetadata":return"onLoadMetadata";case"onloadeddata":return"onLoadedData";case"onloadstart":return"onLoadStart";case"onplaying":return"onPlaying";case"onplay":return"onPlay";case"onpause":return"onPause";case"onended":return"onEnded";case"ondurationchange":return"onDurationChange";case"oncanplay":return"onCanPlay";case"oncanplaythrough":return"onCanPlayThrough";case"onstalled":return"onStalled";case"onsuspend":return"onSuspend";case"onpopstate":return"onPopState";case"onstorage":return"onStorage";case"onhashchange":return"onHashChange";case"onafterprint":return"onAfterPrint";case"onbeforeprint":return"onBeforePrint";case"onpagehide":return"onPageHide";case"onpageshow":return"onPageShow";}}},{key:"toLiteralString",value:function toLiteralString(elem){var props=this.resolveProps(elem);var string=this.resolveId(elem.getTagName().toLowerCase(),props);string=this.resolveClass(string,props);string=this.resolveAttrs(string,props);return string}}],[{key:"toTemplate",value:function toTemplate(elem,deep){return RMEElemTemplater.getInstance().toTemplate(elem,deep)}},{key:"getElementProps",value:function getElementProps(elem){return RMEElemTemplater.getInstance().resolveProps(elem)}},{key:"toLiteralString",value:function toLiteralString(elem){return RMEElemTemplater.getInstance().toLiteralString(elem)}},{key:"getInstance",value:function getInstance(){if(!this.instance)this.instance=new RMEElemTemplater;return this.instance}}]);return RMEElemTemplater}();var EventPipe=function(){var EventPipe=function(){function EventPipe(){_classCallCheck(this,EventPipe);this.eventsQueue=[];this.callQueue=[];this.loopTimeout}_createClass(EventPipe,[{key:"containsEvent",value:function containsEvent(){return this.eventsQueue.find(function(ev){return ev.type===event.type})}},{key:"send",value:function send(event){if(Util.isEmpty(event.type))throw new Error("Event must have type attribute.");if(!this.containsEvent())this.eventsQueue.push(event);this.loopEvents()}},{key:"loopEvents",value:function loopEvents(){var _this10=this;if(this.loopTimeout)Util.clearTimeout(this.loopTimeout);this.loopTimeout=Util.setTimeout(function(){_this10.callQueue.forEach(function(eventCallback){return _this10.eventsQueue.forEach(function(ev){return eventCallback(ev)})});_this10.eventsQueue=[];_this10.callQueue=[]})}},{key:"receive",value:function receive(eventCallback){this.callQueue.push(eventCallback)}}]);return EventPipe}();var eventPipe=new EventPipe;return{send:eventPipe.send.bind(eventPipe),receive:eventPipe.receive.bind(eventPipe)}}();var HttpFetchRequest=function(){function HttpFetchRequest(){_classCallCheck(this,HttpFetchRequest)}_createClass(HttpFetchRequest,[{key:"get",value:function get(url,init){if(!init)init={};init.method="GET";return this["do"]({url:url,init:init,contentType:Http.JSON})}},{key:"post",value:function post(url,body,init){if(!init)init={};init.method="POST";init.body=body;return this["do"]({url:url,init:init,contentType:Http.JSON})}},{key:"put",value:function put(url,body,init){if(!init)init={};init.method="PUT";init.body=body;return this["do"]({url:url,init:init,contentType:Http.JSON})}},{key:"delete",value:function _delete(url,init){if(!init)init={};init.method="DELETE";return this["do"]({url:url,init:init,contentType:Http.JSON})}},{key:"do",value:function _do(config){if(!config.init)config.init={};if(config.contentType){if(!config.init.headers)config.init.headers=new Headers({});if(!config.init.headers.has("Content-Type"))config.init.headers.set("Content-Type",config.contentType)}if(config.method){config.init.method=config.method}return fetch(config.url,config.init)}}]);return HttpFetchRequest}();var Http=function(){var Http=function(){function Http(config){_classCallCheck(this,Http);config.contentType=config.contentType===undefined?Http.JSON:config.contentType;if(config.useFetch){this.self=new HttpFetchRequest}else if(window.Promise){this.self=new HttpPromiseAjax(config).instance()}else{this.self=new HttpAjax(config)}}_createClass(Http,[{key:"instance",value:function instance(){return this.self}}],[{key:"get",value:function get(url,requestContentType){return new Http({method:"GET",url:url,data:undefined,contentType:requestContentType}).instance()}},{key:"post",value:function post(url,data,requestContentType){return new Http({method:"POST",url:url,data:data,contentType:requestContentType}).instance()}},{key:"put",value:function put(url,data,requestContentType){return new Http({method:"PUT",url:url,data:data,contentType:requestContentType}).instance()}},{key:"delete",value:function _delete(url,requestContentType){return new Http({method:"DELETE",url:url,data:undefined,contentType:requestContentType}).instance()}},{key:"do",value:function _do(config){return new Http(config).instance()}},{key:"fetch",value:function fetch(){return new Http({useFetch:true}).instance()}}]);return Http}();Http.JSON="application/json;charset=UTF-8";Http.FORM_DATA="multipart/form-data";Http.TEXT_PLAIN="text/plain";var HttpAjax=function(){function HttpAjax(config){_classCallCheck(this,HttpAjax);this.progressHandler=config.onProgress?config.onProgress:function(event){};this.data=isContentTypeJson(config.contentType)?JSON.stringify(config.data):config.data;this.xhr=new XMLHttpRequest;this.xhr.open(config.method,config.url);if(config.contentType)this.xhr.setRequestHeader("Content-Type",config.contentType);if(config.headers)setXhrHeaders(this.xhr,config.headers)}_createClass(HttpAjax,[{key:"then",value:function then(successHandler,errorHandler){var _this11=this;this.xhr.onload=function(){_this11.xhr.responseJSON=tryParseJSON(_this11.xhr.responseText);isResponseOK(_this11.xhr.status)?successHandler(resolveResponse(_this11.xhr.response),_this11.xhr):errorHandler(_this11.xhr)};this.xhr.onprogress=function(event){if(_this11.progressHandler)_this11.progressHandler(event)};if(this.xhr.ontimeout&&config.onTimeout){this.xhr.ontimeout=function(event){config.onTimeout(event)}}this.xhr.onerror=function(){_this11.xhr.responseJSON=tryParseJSON(_this11.xhr.responseText);if(errorHandler)errorHandler(_this11.xhr)};this.data?this.xhr.send(this.data):this.xhr.send();return this}},{key:"catch",value:function _catch(errorHandler){var _this12=this;this.xhr.onerror=function(){_this12.xhr.responseJSON=tryParseJSON(_this12.xhr.responrenderseText);if(errorHandler)errorHandler(_this12.xhr)}}}]);return HttpAjax}();var HttpPromiseAjax=function(){function HttpPromiseAjax(config){var _this13=this;_classCallCheck(this,HttpPromiseAjax);this.data=isContentTypeJson(config.contentType)?JSON.stringify(config.data):config.data;this.promise=new Promise(function(resolve,reject){var request=new XMLHttpRequest;request.open(config.method,config.url);if(config.contentType)request.setRequestHeader("Content-Type",config.contentType);if(config.headers)setXhrHeaders(request,config.headers);request.onload=function(){request.responseJSON=tryParseJSON(request.responseText);isResponseOK(request.status)?resolve(resolveResponse(request.response)):reject(request)};if(request.ontimeout&&config.onTimeout){request.ontimeout=function(event){config.onTimeout(event)}}request.onprogress=function(event){if(config.onProgress)config.onProgress(event)};request.onerror=function(){request.responseJSON=tryParseJSON(request.responseText);reject(request)};_this13.data?request.send(_this13.data):request.send()})}_createClass(HttpPromiseAjax,[{key:"instance",value:function instance(){return this.promise}}]);return HttpPromiseAjax}();var resolveResponse=function resolveResponse(response){var resp=tryParseJSON(response);if(Util.isEmpty(resp))resp=response;return resp};var setXhrHeaders=function setXhrHeaders(xhr,headers){for(var header in headers){if(headers.hasOwnProperty(header))xhr.setRequestHeader(header,headers[header])}};var isResponseOK=function isResponseOK(status){var okResponses=[200,201,202,203,204,205,206,207,208,226];var i=0;while(i<okResponses.length){if(okResponses[i]===status)return true;i++}return false};var isContentTypeJson=function isContentTypeJson(contentType){return contentType===Http.JSON};var tryParseJSON=function tryParseJSON(text){try{return JSON.parse(text)}catch(e){}};return Http}();var Key=function Key(){_classCallCheck(this,Key)};Key.ENTER="Enter";Key.ESC="Escape";Key.TAB="Tab";Key.F1="F1";Key.F2="F2";Key.F3="F3";Key.F4="F4";Key.F5="F5";Key.F6="F6";Key.F7="F7";Key.F8="F8";Key.F9="F9";Key.F10="F10";Key.F11="F11";Key.F12="F12";Key.A="a";Key.B="b";Key.C="c";Key.D="d";Key.E="e";Key.F="f";Key.G="g";Key.H="h";Key.I="i";Key.J="j";Key.L="l";Key.M="m";Key.N="n";Key.O="o";Key.P="p";Key.Q="q";Key.R="r";Key.S="s";Key.T="t";Key.U="u";Key.V="v";Key.W="w";Key.X="x";Key.Y="y";Key.Z="z";Key.CAPS_LOCK="CapsLock";Key.NUM_LOCK="NumLock";Key.SCROLL_LOCK="ScrollLock";Key.PAUSE="Pause";Key.PRINT_SCREEN="PrintScreen";Key.PAGE_UP="PageUp";Key.PAGE_DOWN="PageDown";Key.END="End";Key.HOME="Home";Key.DELETE="Delete";Key.INSERT="Insert";Key.ALT="Alt";Key.CTRL="Control";Key.CONTEXT_MENU="ContextMenu";Key.OS="OS";Key.ALTGR="AltGraph";Key.SHIFT="Shift";Key.BACKSPACE="Backspace";Key.SECTION="\xA7";Key.ONE="1";Key.TWO="2";Key.THREE="3";Key.FOUR="4";Key.FIVE="5";Key.SIX="6";Key.SEVEN="7";Key.EIGHT="8";Key.NINE="9";Key.ZERO="0";Key.PLUS="+";Key.MINUS="-";Key.STAR="*";Key.SLASH="/";Key.ARROW_UP="ArrowUp";Key.ARROW_RIGHT="ArrowRight";Key.ARROW_DOWN="ArrowDown";Key.ARROW_LEFT="ArrowLeft";Key.COMMA=",";Key.DOT=".";var Messages=function(){var Messages=function(){function Messages(){_classCallCheck(this,Messages);this.instance=this;this.messages=[];this.locale="";this.translated=[];this.load=function(){};this.messagesType;this.app;this.ready=false;this.registerMessages()}_createClass(Messages,[{key:"registerMessages",value:function registerMessages(){var _this14=this;document.addEventListener("readystatechange",function(){if(document.readyState==="complete"){_this14.ready=true;_this14.runTranslated.call(_this14)}})}},{key:"setLoad",value:function setLoad(loader){this.load=loader}},{key:"setAppInstance",value:function setAppInstance(appInstance){this.app=appInstance}},{key:"setLocale",value:function setLocale(locale){this.locale=locale;return this}},{key:"setMessages",value:function setMessages(messages){if(Util.isArray(messages))this.messagesType="array";else if(Util.isObject(messages))this.messagesType="map";else throw"messages must be type array or object";this.messages=messages;this.runTranslated.call(this)}},{key:"getMessage",value:function getMessage(text){for(var _len4=arguments.length,params=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){params[_key4-1]=arguments[_key4]}if(Util.isEmpty(params[0][0])){return this.resolveMessage(text)}else{this.getTranslatedElemIfExist(text,params[0][0]);var msg=this.resolveMessage(text);return this.resolveParams(msg,params[0][0])}}},{key:"resolveMessage",value:function resolveMessage(text){if(this.messagesType==="array"){return this.resolveMessagesArray(text)}else if(this.messagesType==="map"){return this.resolveMessagesMap(text)}}},{key:"resolveMessagesMap",value:function resolveMessagesMap(text){var msg=text;for(var i in this.messages){if(i===text){msg=this.messages[i];break}}return msg}},{key:"resolveMessagesArray",value:function resolveMessagesArray(text){var i=0;var msg=text;while(i<this.messages.length){if(!Util.isEmpty(this.messages[i][text])){msg=this.messages[i][text];break}i++}return msg}},{key:"resolveParams",value:function resolveParams(msg,params){if(!Util.isEmpty(msg)){var i=0;while(i<params.length){msg=msg.replace("{"+i+"}",params[i]);i++}return msg}}},{key:"getTranslatedElemIfExist",value:function getTranslatedElemIfExist(key,params){var last=params[params.length-1];if(Util.isObject(last)&&last instanceof Elem){last=params.pop();if(Util.isEmpty(this.app)){this.translated.push({key:key,params:params,obj:last})}}}},{key:"runTranslated",value:function runTranslated(){var _this15=this;if(Util.isEmpty(this.app)&&this.ready){Util.setTimeout(function(){var i=0;while(i<_this15.translated.length){_this15.translated[i].obj.setText.call(_this15.translated[i].obj,Messages.message(_this15.translated[i].key,_this15.translated[i].params));i++}})}else if(this.ready){this.app.refresh()}}}],[{key:"locale",value:function locale(){return Messages.getInstance().locale}},{key:"lang",value:function lang(locale){var loc;if(Util.isObject(locale)&&locale instanceof Event){locale.preventDefault();var el=Elem.wrap(locale.target);loc=el.getHref();if(Util.isEmpty(loc))loc=el.getValue();if(Util.isEmpty(loc))loc=el.getText()}else if(Util.isString(locale))loc=locale;else throw"Given parameter must be type string or instance of Event, given value: "+locale;if(!Util.isEmpty(loc))Messages.getInstance().setLocale(loc).load.call(null,Messages.getInstance().locale,Messages.getInstance().setMessages.bind(Messages.getInstance()))}},{key:"message",value:function message(text){for(var _len5=arguments.length,params=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){params[_key5-1]=arguments[_key5]}return Messages.getInstance().getMessage(text,params)}},{key:"load",value:function load(loader){if(!Util.isFunction(loader))throw"loader must be type function "+Util.getType(loader);Messages.getInstance().setLoad(loader)}},{key:"setApp",value:function setApp(appInstance){Messages.getInstance().setAppInstance(appInstance);return Messages}},{key:"getInstance",value:function getInstance(){if(!this.instance)this.instance=new Messages;return this.instance}}]);return Messages}();return{lang:Messages.lang,message:Messages.message,load:Messages.load,locale:Messages.locale,setApp:Messages.setApp}}();var configure=function(){return function(){var config={};for(var _len6=arguments.length,params=new Array(_len6),_key6=0;_key6<_len6;_key6++){params[_key6]=arguments[_key6]}params.forEach(function(param){if(param.routes){config=_objectSpread({},config,{router:param})}else if(param.load){config=_objectSpread({},config,{messages:param})}else if(param.name){config=_objectSpread({},config,{app:param})}});if(Util.notEmpty(config.router))config.router.setApp(config.app);if(Util.notEmpty(config.messages))config.messages.setApp(config.app);if(Util.notEmpty(config.app))config.app.setRouter(config.router)}}();var script=function(){var addScript=function addScript(elem){var scripts=Tree.getHead().getByTag("script");if(scripts.length>0){var lastScript=scripts[scripts.length-1];lastScript.after(elem)}else{Tree.getHead().append(elem)}};return function(source,options){if(Util.notEmpty(source)){addScript(Template.resolve({script:_objectSpread({src:source},options)}))}}}();var ready=function(){var callbacks=[];document.addEventListener("readystatechange",function(){if(document.readyState==="complete"){callbacks.forEach(function(callback){return callback()});callbacks.length=0}});return function(callback){callbacks.push(callback)}}();var RME=function(){var RMEStorage=function(){function RMEStorage(){_classCallCheck(this,RMEStorage);this.rmeState={}}_createClass(RMEStorage,[{key:"setRmeStateProp",value:function setRmeStateProp(key,value){this.rmeState[key]=value}},{key:"getRmeStateProp",value:function getRmeStateProp(key){return this.rmeState[key]}}]);return RMEStorage}();var rmeStorage=new RMEStorage;var component=function component(_component2,props){if(_component2&&(Util.isFunction(_component2)||Util.isObject(_component2)))RMEComponentManager.addComponent(_component2,props);else if(_component2&&Util.isString(_component2))return RMEComponentManager.getComponent(_component2,props)};var storage=function storage(key,value){if(Util.notEmpty(key)&&Util.notEmpty(value))rmeStorage.setRmeStateProp(key,value);else if(Util.notEmpty(key)&&Util.isEmpty(value))return rmeStorage.getRmeStateProp(key)};return{component:component,storage:storage}}();var Router=function(){var Router=function(){function Router(){var _this16=this;_classCallCheck(this,Router);this.instance=null;this.root=null;this.origRoot=null;this.routes=[];this.origRoutes=[];this.currentRoute={};this.prevUrl=location.pathname;this.loadCall=function(){return _this16.navigateUrl(location.pathname)};this.hashCall=function(){return _this16.navigateUrl(location.hash)};this.useHistory=true;this.autoListen=true;this.useHash=false;this.scrolltop=true;this.app;this.registerRouter()}_createClass(Router,[{key:"registerRouter",value:function registerRouter(){var _this17=this;document.addEventListener("readystatechange",function(){if(document.readyState==="complete"){var check=Util.setInterval(function(){var hasRoot=!Util.isEmpty(_this17.root.elem)?document.querySelector(_this17.root.elem):false;if(hasRoot){Util.clearInterval(check);_this17.resolveRoutes()}},50)}})}},{key:"registerListeners",value:function registerListeners(){if(this.useHistory&&this.autoListen)window.addEventListener("load",this.loadCall);else if(!this.useHistory&&this.autoListen)window.addEventListener("hashchange",this.hashCall);if(!this.autoListen)window.addEventListener("popstate",this.onPopState.bind(this))}},{key:"clearListeners",value:function clearListeners(){window.removeEventListener("load",this.loadCall);window.removeEventListener("hashchange",this.hashCall);if(!this.autoListen)window.removeEventListener("popstate",this.onPopState)}},{key:"onPopState",value:function onPopState(){if(this.useHistory)this.renderRoute(location.pathname);else this.renderRoute(location.hash)}},{key:"setUseHistory",value:function setUseHistory(use){this.useHistory=use}},{key:"setAutoListen",value:function setAutoListen(listen){this.autoListen=listen}},{key:"setAutoScrollUp",value:function setAutoScrollUp(auto){this.scrolltop=auto}},{key:"setApp",value:function setApp(appInstance){this.app=appInstance}},{key:"resolveRoutes",value:function resolveRoutes(){if(Util.isString(this.root.elem)){this.root.elem=this.resolveElem(this.root.elem)}else if(Util.isEmpty(this.root)){this.root=this.routes.shift();this.root.elem=this.resolveElem(this.root.elem);this.origRoot=this.root.elem}if(this.useHash){this.renderRoute(location.hash)}else{this.renderRoute(location.pathname)}}},{key:"setRoutes",value:function setRoutes(routes){this.routes=routes}},{key:"addRoute",value:function addRoute(route){this.routes.push(route)}},{key:"setRoot",value:function setRoot(route){this.root=route;this.origRoot=route.elem}},{key:"resolveRouteElems",value:function resolveRouteElems(routes){var i=0;while(i<routes.length){routes[i].elem=this.resolveElem(routes[i].elem);i++}return routes}},{key:"resolveElem",value:function resolveElem(elem,props){if(Util.isFunction(elem)&&RMEComponentManager.hasComponent(elem.valueOf().name)){return RMEComponentManager.getComponent(elem.valueOf().name,props)}else if(Util.isString(elem)&&RMEComponentManager.hasComponent(elem)){return RMEComponentManager.getComponent(elem,props)}else if(Util.isString(elem)&&this.isSelector(elem)){return Tree.getFirst(elem)}else if(elem instanceof Elem){return elem}else if(Util.isEmpty(elem)){return elem}throw new Error("Could not resolve a route elem: ".concat(elem))}},{key:"isSelector",value:function isSelector(tag){return tag.charAt(0)==="."||tag.charAt(0)==="#"||Template.isTag(tag)}},{key:"navigateUrl",value:function navigateUrl(url){var route=this.findRoute(url);if(!Util.isEmpty(route)&&this.useHistory&&!route.hide){history.pushState(null,null,url)}else if(!Util.isEmpty(route)&&!route.hide){location.href=url}if(!Util.isEmpty(this.root)&&!Util.isEmpty(route)){if(route.scrolltop===true||route.scrolltop===undefined&&this.scrolltop)Util.setTimeout(function(){return Browser.scrollTo(0,0)});this.prevUrl=this.getUrlPath(url);this.currentRoute=route;if(Util.isEmpty(this.app)){if(!Util.isEmpty(route.onBefore))route.onBefore();this.root.elem.render(this.resolveElem(route.elem,route.compProps));if(!Util.isEmpty(route.onAfter))route.onAfter()}else{if(!Util.isEmpty(route.onBefore))route.onBefore();this.app.refresh()}}}},{key:"findRoute",value:function findRoute(url,force){var i=0;if(!Util.isEmpty(url)&&(this.prevUrl!==this.getUrlPath(url)||force)){while(i<this.routes.length){if(this.matches(this.routes[i].route,url))return this.routes[i];i++}}return null}},{key:"renderRoute",value:function renderRoute(url){var route=this.findRoute(url,true);if(!Util.isEmpty(route)&&Util.isEmpty(this.app)){if(!Util.isEmpty(route.onBefore))route.onBefore();this.root.elem.render(this.resolveElem(route.elem,route.compProps));this.currentRoute=route;if(!Util.isEmpty(route.onAfter))route.onAfter()}else if(Util.isEmpty(this.app)){this.root.elem.render()}else if(!Util.isEmpty(route)&&!Util.isEmpty(this.app)){if(!Util.isEmpty(route.onBefore))route.onBefore();this.app.refresh();this.currentRoute=route}this.prevUrl=location.pathname}},{key:"matches",value:function matches(url,newUrl){if(this.useHistory){url=Util.isString(url)?url.replace(/\*/g,".*").replace(/\/{2,}/g,"/"):url;var path=this.getUrlPath(newUrl);var found=path.match(url);if(!Util.isEmpty(found))found=found.join();return found===path&&new RegExp(url).test(newUrl)}else{if(Util.isString(url)){url=url.replace(/\*/g,".*");if(url.charAt(0)!=="#")url="#".concat(url)}var hash=newUrl.match(/\#{1}.*/).join();var _found=hash.match(url);if(!Util.isEmpty(_found))_found=_found.join();return _found===hash&&new RegExp(url).test(newUrl)}}},{key:"getUrlPath",value:function getUrlPath(url){return this.useHash?url:url.replace(/\:{1}\/{2}/,"").match(/\/{1}.*/).join()}},{key:"getCurrentState",value:function getCurrentState(){return{root:this.origRoot,rootElem:this.root.elem,current:this.resolveElem(this.currentRoute.elem,this.currentRoute.compProps),onAfter:this.currentRoute.onAfter}}}],[{key:"navigate",value:function navigate(url,event){if(Util.isString(url))Router.getInstance().navigateUrl(url);else if(Util.isObject(url)&&url instanceof Event){if(!Router.getInstance().autoListen||Router.getInstance().useHash)url.preventDefault();Router.getInstance().navigateUrl(url.target.href)}else if(Util.isObject(url)&&url instanceof Elem&&!Util.isEmpty(event)&&Util.isObject(event)&&event instanceof Event){if(!Router.getInstance().autoListen||Router.getInstance().useHash)event.preventDefault();Router.getInstance().navigateUrl(url.getHref())}}},{key:"root",value:function root(elem){Router.getInstance().setRoot({elem:elem});return Router}},{key:"add",value:function add(url,elem,hide){Router.getInstance().addRoute({route:url,elem:elem,hide:hide});return Router}},{key:"routes",value:function routes(_routes){if(!Util.isArray(_routes))throw"Could not set routes. Given parameter: \""+_routes+"\" is not an array.";Router.getInstance().setRoutes(_routes);return Router}},{key:"url",value:function url(manual){Router.getInstance().setUseHistory(true);Router.getInstance().registerListeners();if(Util.isBoolean(manual)&&manual){Router.manual()}return Router}},{key:"manual",value:function manual(){if(Router.getInstance().useHistory){Router.getInstance().clearListeners();Router.getInstance().setAutoListen(false);Router.getInstance().registerListeners()}return Router}},{key:"hash",value:function hash(){Router.getInstance().setUseHistory(false);Router.getInstance().setAutoListen(true);Router.getInstance().registerListeners();Router.getInstance().useHash=true;return Router}},{key:"scroll",value:function scroll(auto){if(Util.isBoolean(auto)){Router.getInstance().setAutoScrollUp(auto)}return Router}},{key:"setApp",value:function setApp(appInstance){if(!Util.isEmpty(appInstance))Router.getInstance().setApp(appInstance);return Router}},{key:"getCurrentState",value:function getCurrentState(){return Router.getInstance().getCurrentState()}},{key:"getInstance",value:function getInstance(){if(Util.isEmpty(this.instance))this.instance=new Router;return this.instance}}]);return Router}();return{navigate:Router.navigate,root:Router.root,add:Router.add,routes:Router.routes,url:Router.url,hash:Router.hash,scroll:Router.scroll,getCurrentState:Router.getCurrentState,setApp:Router.setApp}}();var Session=function(){function Session(){_classCallCheck(this,Session)}_createClass(Session,null,[{key:"set",value:function set(key,value){sessionStorage.setItem(key,value)}},{key:"get",value:function get(key){return sessionStorage.getItem(key)}},{key:"remove",value:function remove(key){sessionStorage.removeItem(key)}},{key:"clear",value:function clear(){sessionStorage.clear()}}]);return Session}();var Storage=function(){function Storage(){_classCallCheck(this,Storage)}_createClass(Storage,null,[{key:"set",value:function set(key,value){localStorage.setItem(key,value)}},{key:"get",value:function get(key){return localStorage.getItem(key)}},{key:"remove",value:function remove(key){localStorage.removeItem(key)}},{key:"clear",value:function clear(){localStorage.clear()}}]);return Storage}();var Template=function(){var Template=function(){function Template(){_classCallCheck(this,Template);this.template={};this.root=null}_createClass(Template,[{key:"setTemplateAndResolve",value:function setTemplateAndResolve(template,parent){this.template=template;if(parent){this.root=parent;this.resolve(this.template,this.root,1)}else{this.resolve(this.template,this.root,0)}return this.root}},{key:"resolve",value:function resolve(template,parent,round){for(var obj in template){if(template.hasOwnProperty(obj)){if(round===0){this.root=this.resolveElement(obj,template[obj]);if(this.isArray(template[obj])){++round;this.resolveArray(template[obj],this.root,round)}else if(!this.isComponent(obj)&&Util.isObject(template[obj])){++round;this.resolve(template[obj],this.root,round)}else if(Util.isString(template[obj])||Util.isNumber(template[obj])){++round;this.resolveStringNumber(this.root,template[obj])}else if(Util.isFunction(template[obj])){++round;this.resolveFunction(this.root,template[obj],round)}else if(Template.isAttr(obj,this.root)){this.resolveAttributes(this.root,obj,this.resolveFunctionBasedAttribute(template[obj]))}else if(this.isEventKeyVal(obj,template[obj])){this.bindEventToElement(this.root,template[obj],this.root[obj])}}else{if(Template.isAttr(obj,parent)){this.resolveAttributes(parent,obj,this.resolveFunctionBasedAttribute(template[obj]))}else if(this.isEventKeyVal(obj,template[obj])){this.bindEventToElement(parent,template[obj],parent[obj])}else{++round;var child=this.resolveElement(obj,template[obj]);if(Template.isFragment(child)){this.resolveFragment(child.fragment||template[obj],parent,round)}else{parent.append(child);if(this.isArray(template[obj])){this.resolveArray(template[obj],child,round)}else if(!this.isComponent(obj)&&Util.isObject(template[obj])){this.resolve(template[obj],child,round)}else if(Util.isString(template[obj])||Util.isNumber(template[obj])){this.resolveStringNumber(child,template[obj])}else if(Util.isFunction(template[obj])){this.resolveFunction(child,template[obj],round)}}}}}}}},{key:"bindEventToElement",value:function bindEventToElement(elemInstance,sourceFunction,targetFunction){targetFunction.call(elemInstance,sourceFunction)}},{key:"resolveFragment",value:function resolveFragment(fragment,parent,round){if(this.isArray(fragment)){this.resolveArray(fragment,parent,round)}else if(Util.isFunction(fragment)){var ret=fragment.call(parent,parent);if(this.isArray(ret))this.resolveArray(ret,parent,round);else Template.resolveToParent(ret,parent)}else{this.resolve(fragment,parent,round)}}},{key:"resolveFunctionBasedAttribute",value:function resolveFunctionBasedAttribute(attrValue){return Util.isFunction(attrValue)?attrValue.call():attrValue}},{key:"isArray",value:function isArray(nextValue){return Util.isArray(nextValue)||!Util.isEmpty(nextValue)&&Util.isArray(nextValue._rme_type_)}},{key:"resolveArray",value:function resolveArray(nextValue,parent,round){var array=nextValue._rme_type_||nextValue;if(nextValue._rme_props_){this.resolve(nextValue._rme_props_,parent,round)}var i=0;while(i<array.length){var o=array[i];for(var key in o){if(o.hasOwnProperty(key)){if(Util.isObject(o[key])){this.resolve(o,parent,round)}else if(Util.isString(o[key])||Util.isNumber(o[key])){var el=this.resolveElement(key);this.resolveStringNumber(el,o[key]);parent.append(el)}else if(Util.isFunction(o[key])){var _el=this.resolveElement(key);this.resolveFunction(_el,o[key]);parent.append(_el)}}}i++}}},{key:"resolveStringNumber",value:function resolveStringNumber(elem,value){if(Util.isString(value)&&this.isMessage(value))this.resolveMessage(elem,value);else elem.setText(value)}},{key:"resolveFunction",value:function resolveFunction(elem,func,round){var ret=func.call(elem,elem);if(!Util.isEmpty(ret)){if(Util.isString(ret)&&this.isMessage(ret)){this.resolveMessage(elem,ret)}else if(Util.isString(ret)||Util.isNumber(ret)){elem.setText(ret)}else if(this.isArray(ret)){this.resolveArray(ret,elem,round)}else if(Util.isObject(ret)){this.resolve(ret,elem,round)}}}},{key:"isMessage",value:function isMessage(message){message=this.normalizeMessageString(message);return Util.notEmpty(Messages.message(message))&&Messages.message(message)!=message}},{key:"resolveElement",value:function resolveElement(tag,obj){var resolved=null;var match=[];var el=this.getElementName(tag);if(RMEComponentManager.hasComponent(el)){el=el.replace(/component:/,"");resolved=RMEComponentManager.getComponent(el,obj);if(Util.isEmpty(resolved))return resolved}else if(Util.isEmpty(el)){throw"Template resolver could not find element: ".concat(el," from the given tag: ").concat(tag)}else if(el.indexOf("fragment")===0){return el.match(/fragment/).join()}else{resolved=new Elem(el)}match=tag.match(/[a-z0-9]+\#[a-zA-Z0-9\-]+/);if(!Util.isEmpty(match))resolved.setId(match.join().replace(/[a-z0-9]+\#/g,""));match=this.cutAttributesIfFound(tag).match(/\.[a-zA-Z-0-9\-]+/g);if(!Util.isEmpty(match))resolved.addClasses(match.join(" ").replace(/\./g,""));match=tag.match(/\[[a-zA-Z0-9\= \:\(\)\#\-\_\/\.&%@!?$+|;\\<\\>\\{}"]+\]/g);if(!Util.isEmpty(match))resolved=this.addAttributes(resolved,match);return resolved}},{key:"cutAttributesIfFound",value:function cutAttributesIfFound(tag){var idx=tag.indexOf("[");return tag.substring(0,idx>0?idx:tag.length)}},{key:"getElementName",value:function getElementName(str){if(!Util.isEmpty(str))return str.match(/component:?[a-zA-Z0-9]+|[a-zA-Z0-9]+/).join()}},{key:"addAttributes",value:function addAttributes(elem,attrArray){var i=0;var start="[";var eq="=";var end="]";while(i<attrArray.length){var attr=attrArray[i];var key=attr.substring(attr.indexOf(start)+1,attr.indexOf(eq));var val=attr.substring(attr.indexOf(eq)+1,attr.indexOf(end));this.resolveAttributes(elem,key,val);i++}return elem}},{key:"resolveAttributes",value:function resolveAttributes(elem,key,val){switch(key){case"id":elem.setId(val);break;case"class":elem.addClasses(val||"");break;case"text":elem.setText(val||"");break;case"message":this.resolveMessage(elem,val);break;case"placeholder":this.resolvePlaceholder(elem,key,val);break;case"content":this.resolveContent(elem,key,val);break;case"tabIndex":elem.setTabIndex(val);break;case"editable":elem.setEditable(val);break;case"checked":elem.setChecked(val);break;case"disabled":elem.setDisabled(val);break;case"selected":elem.setSelected(val);break;case"visible":elem.setVisible(val);break;case"display":elem.display(val);break;case"styles":elem.setStyles(val);break;case"click":elem.click();break;case"focus":elem.focus();break;case"blur":elem.blur();break;case"maxLength":elem.setMaxLength(val);break;case"minLength":elem.setMinLength(val);break;default:this.resolveDefault(elem,key,val);}}},{key:"resolvePlaceholder",value:function resolvePlaceholder(elem,key,val){var params=this.getMessageParams(val);var message=this.normalizeMessageString(val);elem.setAttribute(key,this.isMessage(val)?Messages.message(message,params):val)}},{key:"resolveDefault",value:function resolveDefault(elem,key,val){if(key.indexOf("data")===0&&key.length>"data".length)elem.setData(key.replace(/[A-Z]/,key.charAt(4).toLowerCase()).replace("data",""),val);else elem.setAttribute(key,val)}},{key:"resolveContent",value:function resolveContent(elem,key,val){if(elem.getTagName().toLowerCase()==="meta")elem.setAttribute(key,val);else elem.setContent(val)}},{key:"resolveMessage",value:function resolveMessage(elem,message){if(Util.isEmpty(message))throw"message must not be empty";elem.message(this.normalizeMessageString(message),this.getMessageParams(message))}},{key:"getMessageParams",value:function getMessageParams(message){var match=this.getMessageParameterString(message);match=match&&match.join().replace(/({|}|:|;)/g,match.join()).split(match.join());return match&&match.filter(Util.notEmpty)}},{key:"getMessageParameterString",value:function getMessageParameterString(message){return message.match(/\:?(\{.*\}\;?)/g)}},{key:"normalizeMessageString",value:function normalizeMessageString(message){var params=this.getMessageParameterString(message);return Util.notEmpty(params)?message.replace(params.join(),""):message}},{key:"isEventKeyVal",value:function isEventKeyVal(key,val){return key.indexOf("on")===0&&Util.isFunction(val)}},{key:"isComponent",value:function isComponent(key){return RMEComponentManager.hasComponent(this.getElementName(key))}}],[{key:"resolveTemplate",value:function resolveTemplate(template){return Template.create().setTemplateAndResolve(template)}},{key:"resolveToParent",value:function resolveToParent(template,parent){return Template.create().setTemplateAndResolve(template,parent)}},{key:"isFragment",value:function isFragment(child){return!Util.isEmpty(child)&&(child==="fragment"||!Util.isEmpty(child.fragment))}},{key:"updateElemProps",value:function updateElemProps(elem,props,oldProps){var mashed=Template.mashElemProps(props,oldProps);var templater=Template.create();for(var p in mashed){if(mashed.hasOwnProperty(p)){if(templater.isEventKeyVal(p,mashed[p])){elem[p].call(elem,mashed[p])}else if(p==="class"){elem.updateClasses(mashed[p]||"")}else if(p==="value"){elem.setAttribute(p,mashed[p]);elem.setValue(mashed[p])}else{templater.resolveAttributes(elem,p,mashed[p])}}}}},{key:"mashElemProps",value:function mashElemProps(newProps,oldProps){var props={};for(var p in oldProps){if(oldProps.hasOwnProperty(p)){if(!newProps[p]&&oldProps[p]){props[p]=p==="style"?"":undefined}}}props=_objectSpread({},props,{},newProps);return props}},{key:"create",value:function create(){return new Template}},{key:"isTemplate",value:function isTemplate(object){var isTemplate=false;if(Util.isObject(object)&&!Util.isArray(object)&&!(object instanceof Elem)){for(var p in object){isTemplate=object.hasOwnProperty(p)&&Template.isTagOrComponent(p);if(isTemplate)break}}return isTemplate}},{key:"isTagOrComponent",value:function isTagOrComponent(tag){tag=tag.match(/component:?[a-zA-Z0-9]+|[a-zA-Z0-9]+/).join().replace("component:","");if(RMEComponentManager.hasComponent(tag))return true;return Template.isTag(tag)}},{key:"isTag",value:function isTag(tag){var tags={a:["a","abbr","acronym","address","applet","area","article","aside","audio"],b:["button","br","b","base","basefont","bdi","bdo","big","blockquote","body"],c:["canvas","caption","center","cite","code","col","colgroup"],d:["div","dd","dl","dt","data","datalist","del","details","dfn","dialog"],e:["em","embed"],f:["form","fieldset","figcaption","figure","font","footer","frame","frameset"],h:["h1","h2","h3","h4","h5","h6","head","header","hr","html"],i:["i","input","img","iframe","ins"],k:["kbd"],l:["label","li","legend","link"],m:["main","meta","map","mark","meter"],n:["nav","noframes","noscript"],o:["option","object","ol","optgroup","output"],p:["p","pre","param","picture","progress"],q:["q"],r:["rp","rt","ruby"],s:["span","select","s","samp","script","section","small","source","strike","strong","style","sub","summary","sup","svg"],t:["table","textarea","td","tr","tt","th","thead","tbody","tfoot","template","time","title","track"],u:["u","ul"],v:["var","video"],w:["wbr"]};var i=0;var tagArray=tags[tag.charAt(0)];if(tagArray){while(i<tagArray.length){if(tagArray[i]===tag)return true;i++}}return false}},{key:"isAttr",value:function isAttr(key,elem){if(key==="span"&&Template.isElem(elem.getTagName(),["col","colgroup"]))return true;else if(key==="label"&&Template.isElem(elem.getTagName(),["track","option","optgroup"]))return true;else if(key==="title"&&(elem.parent()===null||elem.parent().getTagName().toLowerCase()!=="head"))return true;else if(key==="cite"&&Template.isElem(elem.getTagName(),["blockquote","del","ins","q"]))return true;else if(key==="form"&&Template.isElem(elem.getTagName(),["button","fieldset","input","label","meter","object","output","select","textarea"]))return true;else if(key.indexOf("data")===0&&(!RMEComponentManager.hasComponent(key)&&!Template.isElem(elem.getTagName(),["data"])||Template.isElem(elem.getTagName(),["object"])))return true;var attrs={a:["alt","async","autocomplete","autofocus","autoplay","accept","accept-charset","accpetCharset","accesskey","action"],b:["blur"],c:["class","checked","content","contenteditable","crossorigin","crossOrigin","click","charset","cols","colspan","controls","coords"],d:["disabled","display","draggable","dropzone","datetime","default","defer","dir","dirname","download"],e:["editable","enctype"],f:["for","focus","formaction"],h:["href","height","hidden","high","hreflang","headers","http-equiv","httpEquiv"],i:["id","ismap"],k:["kind"],l:["lang","list","loop","low"],m:["message","max","maxlength","maxLength","min","minlength","minLength","multiple","media","method","muted"],n:["name","novalidate"],o:["open","optimum"],p:["placeholder","pattern","poster","preload"],r:["rel","readonly","required","reversed","rows","rowspan"],s:["src","size","selected","step","style","styles","shape","sandbox","scope","sizes","spellcheck","srcdoc","srclang","srcset","start"],t:["text","type","target","tabindex","tabIndex","translate"],u:["usemap"],v:["value","visible"],w:["width","wrap"]};var i=0;var keys=attrs[key.substring(0,1)];if(keys){while(i<keys.length){if(keys[i]===key)return true;i++}}return false}},{key:"isElem",value:function isElem(elemTag,array){var i=0;while(i<array.length){if(array[i]===elemTag.toLowerCase())return true;i++}return false}}]);return Template}();return{resolve:Template.resolveTemplate,isTemplate:Template.isTemplate,isTag:Template.isTag,updateElemProps:Template.updateElemProps,isFragment:Template.isFragment,resolveToParent:Template.resolveToParent}}();var Tree=function(){function Tree(){_classCallCheck(this,Tree)}_createClass(Tree,null,[{key:"get",value:function get(selector){return Elem.wrapElems(document.querySelectorAll(selector))}},{key:"getFirst",value:function getFirst(selector){try{return Elem.wrap(document.querySelector(selector))}catch(e){}}},{key:"getByTag",value:function getByTag(tag){return Elem.wrapElems(document.getElementsByTagName(tag))}},{key:"getByName",value:function getByName(name){return Elem.wrapElems(document.getElementsByName(name))}},{key:"getById",value:function getById(id){try{return Elem.wrap(document.getElementById(id))}catch(e){}}},{key:"getByClass",value:function getByClass(classname){return Elem.wrapElems(document.getElementsByClassName(classname))}},{key:"getBody",value:function getBody(){try{return Elem.wrap(document.body)}catch(e){}}},{key:"getHead",value:function getHead(){try{return Elem.wrap(document.head)}catch(e){}}},{key:"getTitle",value:function getTitle(){return document.title}},{key:"setTitle",value:function setTitle(title){document.title=title}},{key:"getActiveElement",value:function getActiveElement(){try{return Elem.wrap(document.activeElement)}catch(e){}}},{key:"getAnchors",value:function getAnchors(){return Elem.wrapElems(document.anchors)}},{key:"getHtmlElement",value:function getHtmlElement(){return document.documentElement}},{key:"getDoctype",value:function getDoctype(){return document.doctype}},{key:"getEmbeds",value:function getEmbeds(){return Elem.wrapElems(document.embeds)}},{key:"getImages",value:function getImages(){return Elem.wrapElems(document.images)}},{key:"getLinks",value:function getLinks(){return Elem.wrapElems(document.links)}},{key:"getScripts",value:function getScripts(){return Elem.wrapElems(document.scripts)}},{key:"getForms",value:function getForms(){return Elem.wrapElems(document.forms)}}]);return Tree}();var Util=function(){function Util(){_classCallCheck(this,Util)}_createClass(Util,null,[{key:"isEmpty",value:function isEmpty(value){return value===null||value===undefined||value===""||Util.isArray(value)&&value.length===0}},{key:"notEmpty",value:function notEmpty(value){return!Util.isEmpty(value)}},{key:"getType",value:function getType(value){return _typeof(value)}},{key:"isType",value:function isType(value,type){return Util.getType(value)===type}},{key:"isFunction",value:function isFunction(func){return Util.isType(func,"function")}},{key:"isBoolean",value:function isBoolean(_boolean8){return Util.isType(_boolean8,"boolean")}},{key:"isString",value:function isString(string){return Util.isType(string,"string")}},{key:"isNumber",value:function isNumber(number){return Util.isType(number,"number")}},{key:"isSymbol",value:function isSymbol(symbol){return Util.isType(symbol,"symbol")}},{key:"isObject",value:function isObject(object){return Util.isType(object,"object")}},{key:"isArray",value:function isArray(array){return Array.isArray(array)}},{key:"setTimeout",value:function setTimeout(callback,milliseconds){if(!Util.isFunction(callback)){throw"callback not fuction"}for(var _len7=arguments.length,params=new Array(_len7>2?_len7-2:0),_key7=2;_key7<_len7;_key7++){params[_key7-2]=arguments[_key7]}return window.setTimeout(callback,milliseconds,params)}},{key:"clearTimeout",value:function clearTimeout(timeoutObject){window.clearTimeout(timeoutObject)}},{key:"setInterval",value:function setInterval(callback,milliseconds){if(!Util.isFunction(callback)){throw"callback not fuction"}for(var _len8=arguments.length,params=new Array(_len8>2?_len8-2:0),_key8=2;_key8<_len8;_key8++){params[_key8-2]=arguments[_key8]}return window.setInterval(callback,milliseconds,params)}},{key:"clearInterval",value:function clearInterval(intervalObject){window.clearInterval(intervalObject)}},{key:"encodeBase64String",value:function encodeBase64String(string){if(!Util.isString(string)){throw"the given parameter is not a string: "+string}return window.btoa(string)}},{key:"decodeBase64String",value:function decodeBase64String(string){if(!Util.isString(string)){throw"the given parameter is not a string: "+string}return window.atob(string)}}]);return Util}();
